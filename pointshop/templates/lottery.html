{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="lottery-container">
    <div class="grid-item" data-item="1"><img src="{% static 'disaposable.jpg' %}" alt="Product 1"></div>
    <div class="grid-item" data-item="2"><img src="{% static 'bitcoin.jpg' %}" alt="Product 2"></div>
    <div class="grid-item" data-item="3"><img src="{% static 'earphone.jpg' %}" alt="Product 3"></div>
    <div class="grid-item" data-item="4"><img src="{% static 'earphonein.jpg' %}" alt="Product 4"></div>
    <div class="grid-item center-item" data-item="spin"><button id="spin-btn">Spin!</button><p>Cost: 50 points</p></div>
    <div class="grid-item" data-item="5"><img src="{% static 'earphonewireless.jpg' %}" alt="Product 5"></div>
    <div class="grid-item" data-item="6"><img src="{% static 'medal.png' %}" alt="Product 6"></div>
    <div class="grid-item" data-item="7"><img src="{% static 'Membership.jpeg' %}" alt="Product 7"></div>
    <div class="grid-item" data-item="8"><img src="{% static 'mihayou.jpg' %}" alt="Product 8"></div>
</div>
<div id="result-message"></div>
{% endblock %}

{% block extra_css %}
<style>
    body, html {
        height: 100%;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f4f4f4;
    }

    .lottery-container {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 10px;
        width: 80vw;  /* 九宫格宽度为视窗宽度的80% */
        height: 80vh; /* 九宫格高度为视窗高度的80% */
        max-width: 600px; /* 最大宽度限制 */
        max-height: 600px; /* 最大高度限制 */
        position: relative;
    }

    .grid-item {
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid #ccc;
        background-color: #f9f9f9;
    }

    .grid-item img {
        max-width: 100%;
        max-height: 100%;
    }

    .center-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    #spin-btn {
        padding: 10px 20px;
        cursor: pointer;
    }

    #result-message {
        text-align: center;
        position: absolute;
        width: 100%;
        bottom: -50px; /* 消息显示在九宫格下方 */
    }
</style>
{% endblock %}


{% block extra_js %}
<script>
    document.getElementById('spin-btn').addEventListener('click', function() {
    const items = document.querySelectorAll('.grid-item:not(.center-item)');
    let currentIndex = 0;

    // Start spinning animation
    const interval = setInterval(() => {
        if (currentIndex > 0) {
            items[currentIndex - 1].classList.remove('active');
        }
        items[currentIndex].classList.add('active');

        currentIndex = (currentIndex + 1) % items.length;
    }, 500); // change every half a second

    // Simulate spinning
    setTimeout(() => {
        clearInterval(interval); // Stop the spinning
        // Randomly select a winning item
        const winningIndex = Math.floor(Math.random() * items.length);
        items[winningIndex].classList.add('winner');
        document.getElementById('result-message').textContent = `Congratulations, you've won ${items[winningIndex].querySelector('img').alt}!`;
    }, 5000); // stop after 5 seconds

        fetch("{% url 'lottery_draw' %}", {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',  // 确保传递CSRF令牌
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        // 这里是处理服务器响应的代码
        if(data.status === 'success') {
            document.getElementById('result-message').innerText = data.message;
            // 这里您可以添加代码来更新页面上的商品信息
            // 例如，显示中奖的商品图片和名称
        }
    });
});

</script>
{% endblock %}
