{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container h-100">
    <div class="row h-100 justify-content-center align-items-center">
        <div class="col-12">
            <div id="lottery" class="row gx-2 gy-2">
                <!-- 第一行的商品图片 -->
                <div class="col-4 grid-item winner">
                    <img src="{% static 'coupon.jpg' %}" alt="Coupon" class="img-fluid">
                </div>
                <div class="col-4 grid-item">
                    <img src="{% static 'earphonewireless.jpg' %}" alt="Earphone Wireless" class="img-fluid">
                </div>
                <div class="col-4 grid-item">
                    <img src="{% static 'disaposable.jpg' %}" alt="Disposable" class="img-fluid">
                </div>
                <!-- 第二行的商品图片和中间的抽奖按钮 -->
                <div class="col-4 grid-item">
                    <img src="{% static 'medal.png' %}" alt="Medal" class="img-fluid">
                </div>
                <!-- 这里是抽奖按钮 -->
                <div class="col-4 grid-item center-item text-center">
                    <button id="spin-btn" class="btn btn-primary btn-lg" type="button">Spin!</button>
                    <p>Cost: 50 points</p>
                </div>
                <div class="col-4 grid-item">
                    <img src="{% static 'pencil.jpeg' %}" alt="Pencil" class="img-fluid">
                </div>
                <!-- 第三行的商品图片 -->
                <div class="col-4 grid-item">
                    <img src="{% static 'sapling.jpg' %}" alt="Sapling" class="img-fluid">
                </div>
                <div class="col-4 grid-item">
                    <img src="{% static 'organic.jpg' %}" alt="Organic" class="img-fluid">
                </div>
                <div class="col-4 grid-item">
                    <img src="{% static 'earphone.jpg' %}" alt="Earphone" class="img-fluid">
                </div>
            </div>
            <div id="result-message" class="text-center"></div>
        </div>
    </div>
</div>
{% endblock %}


{% block extra_css %}
<style>
    /* 确保高度为视口高度，使内容垂直居中 */
    .container {
        max-width: 100%;
        padding: 0;
        margin-top: -50px; /* 根据需要调整这个值，以适应页面布局 */
    }
    .row {
        margin: 0;
    }
    .grid-item {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 150px; /* 或者您想要的高度，确保所有格子大小一致 */
    margin: 5px; /* 格子间隔 */
    background: #f7f7f7;
    border: 1px solid #ddd;
}


.center-item {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#result-message {
    margin-top: 20px;
}

    .center-item button {
        margin: 0 auto; /* 居中按钮 */
        display: block;
    }
    .center-item p {
        text-align: center; /* 积分文字居中 */
    }
@keyframes blink {
        50% { background-color: orange; } /* 高亮颜色 */
    }
    .grid-item.active img{
  opacity: 0.8 !important; /* 使图片稍微透明 */
    transition: opacity 0.5s !important;

}
/* 添加强调中奖项的样式 */
.grid-item.winner {
    position: relative; /* 为伪元素定位做准备 */
    z-index: 1; /* 确保中奖项在最上层 */
}

.grid-item.winner::after {
    content: "Winner!";
    position: absolute; /* 绝对定位，覆盖在格子内容之上 */
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 0, 0.7); /* 半透明的黄色覆盖层 */
    color: black; /* 文字颜色 */
    font-size: 2em; /* 文字大小 */
    display: flex;
    justify-content: center; /* 水平居中 */
    align-items: center; /* 垂直居中 */
    z-index: 2; /* 确保覆盖层在格子内容之上 */
}

.grid-item.winner img {
    opacity: 0.3; /* 降低图片透明度，以突出显示覆盖层 */
    transition: opacity 0.5s !important;
}

    .grid-item.winner {
        background-color: yellow; /* 中奖格子的背景颜色 */
    }

</style>
{% endblock %}

{% block extra_js %}
<script>
// 当点击spin按钮时执行此函数
document.getElementById('spin-btn').addEventListener('click', function(event) {
    event.preventDefault();
    const items = document.querySelectorAll('.grid-item:not(.center-item)');
    let currentIndex = 0;
    let previousIndex = -1;
    let spins = 5 * items.length;
    const spinDuration = 5000;
    const singleSpinDuration = spinDuration / spins;

    // 移除之前可能的 winner 标记
    items.forEach(item => item.classList.remove('winner'));

    // 开始旋转动画
    const interval = setInterval(function () {

        if (previousIndex >= 0) {
            items[previousIndex].classList.remove('active');
            console.log('Active class should be applied to:', items[currentIndex]);
        }
        items[currentIndex].classList.add('active');
        console.log('Active class added to:', items[currentIndex]);

        previousIndex = currentIndex;
        currentIndex = (currentIndex + 1) % items.length;

        spins--;
        if (spins <= 0) {
            clearInterval(interval);
            items[previousIndex].classList.remove('active');

            // 模拟中奖过程
            const winnerIndex = Math.floor(Math.random() * items.length); // 随机选择一个中奖项
            items[winnerIndex].classList.add('winner'); // 添加 winner 类
            console.log('Winner class applied to:', items[winnerIndex]);
            document.getElementById('result-message').textContent = `恭喜你抽到 ${items[winnerIndex].querySelector('img').alt}！`;
        }
    }, singleSpinDuration);
});

</script>
{% endblock %}

