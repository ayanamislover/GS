<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Get your location</title>
</head>
<body>

<script>
function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    console.log("Geolocation is not supported by this browser.");
  }
}

function showPosition(position) {
  var lat = position.coords.latitude;
  var lon = position.coords.longitude;
  console.log("Latitude: " + lat + ", Longitude: " + lon);
  // 将位置数据发送到Django后端
  fetch('/save-location/', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-CSRFToken': getCookie('csrftoken'), // 获取CSRF token, 确保Django接受请求
    },
    body: JSON.stringify({latitude: lat, longitude: lon}),
  })
  .then(response => response.json())
  .then(data => {
    console.log(data);
    window.location.href = '/target-page/'; // ！！！修改为跳转的目标页面URL
  })
  .catch(error => console.error('Error:', error));
}

function showError(error) {
  switch(error.code) {
    case error.PERMISSION_DENIED:
      console.log("User denied the request for Geolocation.");
      break;
    case error.POSITION_UNAVAILABLE:
      console.log("Location information is unavailable.");
      break;
    case error.TIMEOUT:
      console.log("The request to get user location timed out.");
      break;
    case error.UNKNOWN_ERROR:
      console.log("An unknown error occurred.");
      break;
  }
}

// 调用getLocation函数
getLocation();
</script>

</body>
</html>